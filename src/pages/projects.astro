---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

import type { CollectionEntry } from "astro:content";

const projects: CollectionEntry<"projects">[] = await getCollection("projects");

// optional: sort if needed
// projects.sort((a: { data: { order: number; }; }, b: { data: { order: number; }; }) => a.data.order - b.data.order);
---

<Layout title="Projects â€” Inscape Interiors">
  <section class="w-full pb-20 md:pb-28">
    <div class="max-w-[1240px] mx-auto">
      <!-- Page heading -->
      <div class="text-center mb-16 md:mb-20">
        <h1
          class="text-[42px] md:text-[56px] font-light leading-tight mb-8 font-serif text-hyperlink fade-in-element opacity-0 max-w-[600px] mx-auto"
        >
          Projects
        </h1>
      </div>

      <!-- Projects grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
        {
          projects.map((project, index) => (
            <a
              href={`/projects/${project.slug}`}
              class:list={[
                "group relative block overflow-hidden fade-in-element opacity-0",
                index === 0 ? "md:col-span-2" : "",
              ]}
            >
              <div
                class:list={[
                  "relative overflow-hidden",
                  index === 0 ? "aspect-[16/9]" : "aspect-[3/4]",
                ]}
              >
                <img
                  src={project.data.coverImage}
                  alt={`${project.data.title} ${project.data.subtitle}`}
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                  width="777"
                  height="1024"
                  loading={index === 0 ? "eager" : "lazy"}
                  decoding="async"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent" />
                <div class="absolute bottom-0 left-0 right-0 p-6 md:p-8">
                  <h2 class="font-serif font-light text-white text-xl md:text-2xl lg:text-3xl tracking-wide">
                    {project.data.title}
                  </h2>
                  <p class="font-sans text-white/80 text-xs md:text-sm uppercase tracking-widest-plus mt-2">
                    {project.data.subtitle}
                  </p>
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>
</Layout>

<style>
  .fade-in-element {
    transition:
      opacity 1.2s ease-out,
      transform 1.2s ease-out;
    transform: translateY(20px);
  }

  .fade-in-element.visible {
    opacity: 1 !important;
    transform: translateY(0);
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.classList.add("visible");
          }, index * 150);
        }
      });
    },
    { threshold: 0.2 },
  );

  document.querySelectorAll(".fade-in-element").forEach((el) => {
    observer.observe(el);
  });
</script>
